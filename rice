#!/bin/sh

echo establishing resolution...
sudo pacman -S --needed xorg-xrandr

read -p 'Would you like to adjust your resolution? [y\n] ' answer
case $answer in
    [yY] | [yY][eE][sS])
        while true
        do  
            echo 'finding current resolution settings...'
            xrandr 
            read -p 'please enter the name of your monitor or screen i.e. Virtual-1. ' monitor_name
            read -p 'please enter your desired resolution i.e. 1920x1080. ' resolution
            xrandr --output $monitor_name --mode $resolution
            read -p 'would you like to make changes to the resolution? [y/n] ' answer 
            if [ "$answer" = "n" ] || [ "$answer" = "no" ] || [ "$answer" = "No" ] || [ "$answer" = "NO" ]; then
                break
            elif [ "$answer" = "y" ] || [ "$answer" = "yes" ] || [ "$answer" = "Yes" ] || [ "$answer" = "YES" ]; then
                continue
            else
                echo 'invalid input aborting script' && exit 1
            fi
        done
        ;;
    [nN] | [nN][oO])
        echo "skipping resolution configuration"
        ;;
    *)
        echo "Invalid input"
        ;;
esac


sudo pacman -S --needed wget
echo 'Setting up wallpaper management...'
cd ~
sudo pacman -S --needed xwallpaper
mkdir -p  ~/pictures
mkdir -p ~/pictures/wallpapers

# use default wallpaper
wget -O ~/pictures/wallpapers/abstract.png https://w.wallhaven.cc/full/zx/wallhaven-zxxy8o.png
read -p "would you like to install zsh and the zimfw framework? [y/n] " answer
if [ "$answer" = "y" ] || [ "$answer" = "Y" ] || [ "$answer" = "yes" ] || [ "$answer" = "Yes" ] || [ "$answer" = "YES" ]; then
    echo 'installing zsh and zimfw framework...'
    sudo pacman -S --needed zsh
    chsh -s $(which zsh)
    curl -fsSL https://raw.githubusercontent.com/zimfw/install/master/install.zsh | zsh
fi
sudo pacman -S --needed xcompmgr
setsid xcompmgr &
sudo pacman -S -- needed python-pywal
cd ~/.local
git clone https://github.com/Steven-Alvarado/bin.git 
chmod +x ~/.local/bin/*
cd ~/.local/bin
cd ~/.local/bin/dwmblocks
sudo make install
cd ~/.local/bin

sudo pacman -S --needed xdotool
./imagine "$(find ~/pictures/wallpapers -type f \( -name '*.jpg' -o -name '*png' -o -name '*.jpeg' \) | shuf -n 1)"
# Export path to ~/.local/bin in zsh
echo -e '\nexport PATH=$HOME/.local/bin:$PATH' >> ~/.zshrc


# Set up .xinitrc file to run tools on start-up
sed -i '$d' $HOME/.xinitrc
echo -e "# Configure color scheme and background\nimagine \"\$(find ~/pictures/wallpapers -type f \( -name '*.jpg' -o -name '*png' -o -name '*.jpeg' \) | shuf -n 1)\" &\n\n# 
Transparency\nxcompmgr &\n\nexec dwm" >> ~/.xinitrc
echo 'rice is complete!'
echo "simply run 'imagine <wallpaperimage.jpg>' to update color scheme and wallpaper"
echo 'configure changes to .xinitrc and .zshrc accordingly'
exit 0
